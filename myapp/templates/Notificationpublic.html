<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notifications - Panchayat</title>

  <style>
    :root { --primary-blue: #1e3a8a; --hover-blue: #144f8a; --active-blue: #3b82f6; --background: #f8fafc; --card-bg: #ffffff; --text-primary: #1e293b; --text-secondary: #64748b; --border-color: #e2e8f0; --success-green: #16a34a; --danger-red: #dc2626; --unread-bg: #eff6ff; --unread-border: #3b82f6; --read-bg: #ffffff; --read-border: #e2e8f0; --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1); --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1); --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1); }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif; }
    body { display: flex; background: var(--background); min-height: 100vh; color: var(--text-primary); }
    .sidebar { width: 240px; height: 100vh; background: var(--primary-blue); color: #fff; padding: 25px 0; position: fixed; top: 0; left: 0; overflow-y: auto; box-shadow: var(--shadow-lg); z-index: 1000; }
    .sidebar h2 { text-align: center; margin-bottom: 30px; font-size: 22px; letter-spacing: 1px; font-weight: bold; padding: 0 20px; }
    .menu a { display: block; padding: 14px 25px; color: white; text-decoration: none; font-size: 16px; transition: all 0.2s ease; border-left: 4px solid transparent; }
    .menu a:hover { background: var(--hover-blue); padding-left: 30px; }
    .sidebar .active { background: var(--active-blue); border-left: 4px solid #ffffff; }
    .content { margin-left: 240px; width: calc(100% - 240px); min-height: 100vh; padding: 0; }
    .back-btn { background: var(--primary-blue); color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 15px; text-decoration: none; border: none; box-shadow: var(--shadow-sm); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; }
    .back-btn:hover { background: var(--hover-blue); transform: translateY(-2px); box-shadow: var(--shadow-md); }
    .header { background: var(--card-bg); padding: 25px 40px; box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { color: var(--primary-blue); font-size: 28px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
    .header-actions { display: flex; gap: 15px; align-items: center; }
    .mark-all-read-btn { background: transparent; color: var(--primary-blue); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; border: 2px solid var(--primary-blue); transition: all 0.3s ease; font-weight: 500; }
    .mark-all-read-btn:hover { background: var(--primary-blue); color: white; }
    .main-body { padding: 30px 40px; }
    .toast { position: fixed; top: 90px; right: 30px; background: white; padding: 16px 24px; border-radius: 10px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); display: none; align-items: center; gap: 12px; z-index: 2000; min-width: 300px; animation: slideInRight 0.4s ease, fadeOut 0.4s ease 2.6s; border-left: 4px solid var(--success-green); }
    .toast.show { display: flex; }
    .toast-icon { font-size: 24px; flex-shrink: 0; }
    .toast-content { flex: 1; }
    .toast-title { font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
    .toast-message { font-size: 14px; color: var(--text-secondary); }
    .toast-close { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-secondary); padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s ease; }
    .toast-close:hover { background: var(--background); color: var(--text-primary); }
    @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeOut { to { opacity: 0; transform: translateX(400px); } }
    .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: var(--card-bg); padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm); border-left: 4px solid var(--active-blue); transition: all 0.3s ease; }
    .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
    .stat-card.unread { border-left-color: #f59e0b; }
    .stat-card.read { border-left-color: var(--success-green); }
    .stat-number { font-size: 36px; font-weight: 700; color: var(--primary-blue); margin-bottom: 5px; }
    .stat-label { color: var(--text-secondary); font-size: 14px; font-weight: 500; }
    .filter-tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid var(--border-color); padding-bottom: 0; }
    .filter-tab { background: none; border: none; padding: 12px 24px; cursor: pointer; font-size: 15px; font-weight: 500; color: var(--text-secondary); border-bottom: 3px solid transparent; transition: all 0.3s ease; margin-bottom: -2px; }
    .filter-tab:hover { color: var(--primary-blue); }
    .filter-tab.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); }
    .table-container { background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow-sm); overflow: hidden; }
    .notifications-table { width: 100%; border-collapse: collapse; }
    .notifications-table thead { background: linear-gradient(135deg, var(--primary-blue) 0%, #1e40af 100%); color: white; }
    .notifications-table thead th { padding: 16px; text-align: left; font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
    .notifications-table tbody tr { border-bottom: 1px solid var(--border-color); transition: all 0.2s ease; cursor: pointer; }
    .notifications-table tbody tr:hover { background: var(--unread-bg); }
    .notifications-table tbody tr.unread { background: var(--unread-bg); border-left: 4px solid var(--unread-border); }
    .notifications-table tbody td { padding: 16px; color: var(--text-primary); font-size: 14px; }
    .status-indicator { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    .status-unread { background: var(--active-blue); }
    .status-read { background: var(--success-green); }
    .notification-title-cell { font-weight: 600; color: var(--text-primary); }
    .unread .notification-title-cell { color: var(--primary-blue); }
    .notification-message-cell { max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text-secondary); }
    .action-btn { background: #fee2e2; color: var(--danger-red); border: 1px solid #fecaca; padding: 6px 12px; border-radius: 6px; font-size: 18px; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; }
    .action-btn:hover { background: var(--danger-red); color: white; transform: scale(1.05); }
    .empty-state { text-align: center; padding: 80px 20px; color: var(--text-secondary); }
    .empty-state-icon { font-size: 72px; margin-bottom: 20px; opacity: 0.4; }
    .empty-state-text { font-size: 18px; font-weight: 500; margin-bottom: 8px; }
    .empty-state-subtext { font-size: 14px; color: var(--text-secondary); }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 2000; align-items: center; justify-content: center; padding: 20px; animation: fadeIn 0.3s ease; }
    .modal-overlay.show { display: flex; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal { background: white; border-radius: 20px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.3); animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-header { background: linear-gradient(135deg, var(--primary-blue) 0%, #1e40af 100%); color: white; padding: 30px; position: relative; border-radius: 20px 20px 0 0; }
    .modal-header h2 { font-size: 24px; margin: 0 0 8px 0; display: flex; align-items: center; gap: 12px; }
    .modal-header p { opacity: 0.9; font-size: 14px; margin: 0; }
    .modal-close-btn { position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
    .modal-close-btn:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(90deg); }
    .modal-body { padding: 30px; }
    .detail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .detail-item { background: #f9fafb; padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary-blue); }
    .detail-item.full-width { grid-column: 1 / -1; }
    .detail-label { font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
    .detail-value { font-size: 16px; color: #111827; font-weight: 500; word-break: break-word; line-height: 1.6; }
    .media-container { margin-top: 12px; border-radius: 8px; overflow: hidden; }
    .media-container img, .media-container video { width: 100%; max-height: 300px; object-fit: contain; display: block; background: #000; }
    .modal-footer { padding: 20px 30px; border-top: 2px solid #e5e7eb; display: flex; justify-content: center; }
    .modal-footer button { padding: 12px 32px; background: linear-gradient(135deg, var(--primary-blue) 0%, #1e40af 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .modal-footer button:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2); }
    @media (max-width: 768px) { .sidebar { width: 200px; } .content { margin-left: 200px; width: calc(100% - 200px); } .header { padding: 20px 25px; flex-direction: column; gap: 15px; align-items: stretch; } .header-actions { justify-content: space-between; } .header h1 { font-size: 24px; } .main-body { padding: 20px 25px; } .stats-bar { grid-template-columns: 1fr; } .notifications-table { font-size: 12px; } .notifications-table thead th, .notifications-table tbody td { padding: 10px 8px; } .notification-message-cell { max-width: 150px; } .detail-grid { grid-template-columns: 1fr; } .toast { right: 20px; left: 20px; min-width: auto; } }
    @media (max-width: 480px) { .sidebar { width: 60px; padding: 15px 0; } .sidebar h2 { font-size: 14px; writing-mode: vertical-rl; } .menu a { padding: 12px 8px; font-size: 20px; text-align: center; } .menu a:hover { padding-left: 8px; } .content { margin-left: 60px; width: calc(100% - 60px); } .header { padding: 15px 20px; } .main-body { padding: 15px 20px; } .filter-tabs { overflow-x: auto; } .filter-tab { padding: 10px 16px; font-size: 14px; } }
  </style>
</head>

<body>

  <div class="toast" id="toast">
    <span class="toast-icon">‚úì</span>
    <div class="toast-content">
      <div class="toast-title" id="toastTitle">Success</div>
      <div class="toast-message" id="toastMessage">Operation completed successfully</div>
    </div>
    <button class="toast-close" onclick="hideToast()">√ó</button>
  </div>

  <div class="sidebar" role="navigation" aria-label="Main sidebar">
    <h2>PANCHAYAT</h2>
    <div class="menu">
      <a href="{% url 'Mainpage' %}">üè† Home</a>
      <a href="{% url 'notification_page2' %}" class="active">üîî Notifications</a>
      <a href="{% url 'complaint_form' %}">üìù Complaints</a>
      <a href="{% url 'requestform' %}">üìã Requests</a>
      <a href="{% url 'Trackstatus' %}">üîç Complaint Track Status</a>
      <a href="{% url 'Trackstatus2' %}">üîç Request Track Status</a>
    </div>
  </div>

  <div class="content">
    <div class="header">
      <h1>üì¢ Notifications Public</h1>
      <div class="header-actions">
        <button class="mark-all-read-btn" onclick="markAllAsRead()">
          ‚úì Mark all as read
        </button>
        <a href="{% url 'Mainpage' %}" class="back-btn">
          ‚Üê Dashboard
        </a>
      </div>
    </div>

    <div class="main-body">
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-number" id="totalCount">{{ posts|length }}</div>
          <div class="stat-label">Total Notifications</div>
        </div>
        <div class="stat-card unread">
          <div class="stat-number" id="unreadCount">0</div>
          <div class="stat-label">Unread Messages</div>
        </div>
        <div class="stat-card read">
          <div class="stat-number" id="readCount">0</div>
          <div class="stat-label">Read Messages</div>
        </div>
      </div>

      <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterNotifications('all')">
          All Notifications
        </button>
        <button class="filter-tab" onclick="filterNotifications('unread')">
          Unread
        </button>
        <button class="filter-tab" onclick="filterNotifications('read')">
          Read
        </button>
      </div>

      <div class="table-container">
        <table class="notifications-table">
          <thead>
            <tr>
              <th>Status</th>
              <th>Title</th>
              <th>Message</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="notificationsList">
            {% for post in posts %}
            <tr class="notification-row unread" data-id="{{ post.id }}" 
                data-title="{{ post.title }}" 
                data-message="{{ post.message }}" 
                data-date="{{ post.created_at }}"
                data-image="{% if post.image %}{{ post.image.url }}{% endif %}"
                data-video="{% if post.video %}{{ post.video.url }}{% endif %}"
                onclick="openNotificationModal(this)">
              <td>
                <span class="status-indicator status-unread"></span>
              </td>
              <td class="notification-title-cell">{{ post.title }}</td>
              <td class="notification-message-cell">{{ post.message }}</td>
              <td>{{ post.created_at }}</td>
              <td>
                <button class="action-btn" 
                        onclick="event.stopPropagation(); deleteNotification({{ post.id }}, this)"
                        title="Delete notification">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5">
                <div class="empty-state">
                  <div class="empty-state-icon">üì≠</div>
                  <div class="empty-state-text">No notifications yet</div>
                  <div class="empty-state-subtext">You're all caught up!</div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="notificationModal">
    <div class="modal">
      <div class="modal-header">
        <h2><span>üì¢</span> <span id="modalTitle">Notification Details</span></h2>
        <p>View complete notification information</p>
        <button class="modal-close-btn" onclick="closeNotificationModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="detail-grid">
          <div class="detail-item full-width">
            <div class="detail-label">üìã Title</div>
            <div class="detail-value" id="modalTitleValue"></div>
          </div>
          <div class="detail-item full-width">
            <div class="detail-label">üí¨ Message</div>
            <div class="detail-value" id="modalMessageValue"></div>
          </div>
          <div class="detail-item">
            <div class="detail-label">üìÖ Date & Time</div>
            <div class="detail-value" id="modalDateValue"></div>
          </div>
          <div class="detail-item">
            <div class="detail-label">üîñ Status</div>
            <div class="detail-value" id="modalStatusValue"></div>
          </div>
          <div class="detail-item full-width" id="modalMediaContainer" style="display: none;">
            <div class="detail-label">üìé Attachments</div>
            <div class="media-container" id="modalMediaContent"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeNotificationModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    let readNotifications = JSON.parse(localStorage.getItem('readNotifications_user') || '[]');
    
    function updateCounts() {
      const total = document.querySelectorAll('.notification-row').length;
      const unread = document.querySelectorAll('.notification-row.unread').length;
      const read = total - unread;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('unreadCount').textContent = unread;
      document.getElementById('readCount').textContent = read;
    }

    function openNotificationModal(row) {
      const id = row.getAttribute('data-id');
      const title = row.getAttribute('data-title');
      const message = row.getAttribute('data-message');
      const date = row.getAttribute('data-date');
      const image = row.getAttribute('data-image');
      const video = row.getAttribute('data-video');
      const isUnread = row.classList.contains('unread');

      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalTitleValue').textContent = title;
      document.getElementById('modalMessageValue').textContent = message;
      document.getElementById('modalDateValue').textContent = date;
      document.getElementById('modalStatusValue').textContent = isUnread ? 'Unread' : 'Read';

      const mediaContainer = document.getElementById('modalMediaContainer');
      const mediaContent = document.getElementById('modalMediaContent');
      
      if (image || video) {
        mediaContainer.style.display = 'block';
        mediaContent.innerHTML = '';
        
        if (image) {
          mediaContent.innerHTML = `<img src="${image}" alt="${title}">`;
        } else if (video) {
          mediaContent.innerHTML = `<video controls><source src="${video}" type="video/mp4">Your browser does not support the video tag.</video>`;
        }
      } else {
        mediaContainer.style.display = 'none';
      }

      if (row.classList.contains('unread')) {
        row.classList.remove('unread');
        row.querySelector('.status-indicator').classList.remove('status-unread');
        row.querySelector('.status-indicator').classList.add('status-read');
        
        if (!readNotifications.includes(id)) {
          readNotifications.push(id);
          localStorage.setItem('readNotifications_user', JSON.stringify(readNotifications));
        }
        
        updateCounts();
      }

      document.getElementById('notificationModal').classList.add('show');
    }

    function closeNotificationModal() {
      document.getElementById('notificationModal').classList.remove('show');
    }

    function markAllAsRead() {
      const unreadRows = document.querySelectorAll('.notification-row.unread');
      unreadRows.forEach(row => {
        row.classList.remove('unread');
        row.querySelector('.status-indicator').classList.remove('status-unread');
        row.querySelector('.status-indicator').classList.add('status-read');
        
        const id = row.getAttribute('data-id');
        if (!readNotifications.includes(id)) {
          readNotifications.push(id);
        }
      });
      
      localStorage.setItem('readNotifications_user', JSON.stringify(readNotifications));
      updateCounts();
      showToast('Success', 'All notifications marked as read', 'success');
    }

    function filterNotifications(filter) {
      document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');

      const rows = document.querySelectorAll('.notification-row');
      rows.forEach(row => {
        if (filter === 'all') {
          row.style.display = 'table-row';
        } else if (filter === 'unread') {
          row.style.display = row.classList.contains('unread') ? 'table-row' : 'none';
        } else if (filter === 'read') {
          row.style.display = !row.classList.contains('unread') ? 'table-row' : 'none';
        }
      });
    }

    function deleteNotification(postId, button) {
      if (confirm('Are you sure you want to delete this notification?')) {
        const row = button.closest('tr');
        
        row.style.transition = 'all 0.3s ease';
        row.style.opacity = '0';
        row.style.transform = 'translateX(-20px)';
        
        setTimeout(() => {
          readNotifications = readNotifications.filter(id => id !== postId.toString());
          localStorage.setItem('readNotifications_user', JSON.stringify(readNotifications));
          
          window.location.href = `{% url 'delete_post2' 0 %}`.replace('0', postId);
        }, 300);
      }
    }

    function showToast(title, message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastTitle = document.getElementById('toastTitle');
      const toastMessage = document.getElementById('toastMessage');
      
      toastTitle.textContent = title;
      toastMessage.textContent = message;
      
      toast.classList.add('show');
      
      setTimeout(() => {
        hideToast();
      }, 3000);
    }

    function hideToast() {
      document.getElementById('toast').classList.remove('show');
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.notification-row').forEach(row => {
        const notificationId = row.getAttribute('data-id');
        if (readNotifications.includes(notificationId)) {
          row.classList.remove('unread');
          row.querySelector('.status-indicator').classList.remove('status-unread');
          row.querySelector('.status-indicator').classList.add('status-read');
        }
      });
      
      updateCounts();

      {% if messages %}
        {% for message in messages %}
          showToast('Success', '{{ message }}', 'success');
        {% endfor %}
      {% endif %}

      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('deleted') === 'true') {
        showToast('Deleted Successfully', 'Notification has been removed', 'success');
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });

    document.getElementById('notificationModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeNotificationModal();
      }
    });
  </script>

</body>
</html>